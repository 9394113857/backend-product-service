=========================================================
RENDER + NEW NEON DATABASE
COMPLETE FINAL STEPS (PRODUCTION)
=========================================================

PURPOSE
-------
• Use a NEW Neon database with an existing Render service
• Correctly update environment variables
• Ensure Flask app uses the new DB safely
• Zero migration mistakes

---------------------------------------------------------
PRE-CONDITION (ALREADY DONE BY YOU)
---------------------------------------------------------
✔ New Neon database created
✔ Local migrations prepared
✔ Neon DB upgraded or stamped locally
✔ DATABASE_URL removed from local terminal

---------------------------------------------------------
STEP 1️⃣ : COPY NEW NEON DATABASE_URL
---------------------------------------------------------
From Neon Dashboard:
• Project → Database → Connection string
• Copy FULL URL

Example:
postgresql+psycopg://USER:PASSWORD@HOST/DATABASE?sslmode=require

---------------------------------------------------------
STEP 2️⃣ : OPEN RENDER SERVICE
---------------------------------------------------------
• Login to Render Dashboard
• Open your Web Service
  (Auth Service OR Product Service)
• Go to "Environment" / "Environment Variables"

---------------------------------------------------------
STEP 3️⃣ : UPDATE ENVIRONMENT VARIABLES (CRITICAL)
---------------------------------------------------------

REQUIRED:
---------
KEY   : DATABASE_URL
VALUE : <PASTE NEW NEON DATABASE_URL>

✔ This overrides SQLite
✔ This overrides old Neon DB
✔ This is the ONLY required change

OPTIONAL (only if already used):
--------------------------------
FLASK_ENV=production
FLASK_DEBUG=0
JWT_SECRET_KEY=unchanged
SECRET_KEY=unchanged

❌ No code changes needed
❌ No .env file needed
❌ No Render shell access needed

---------------------------------------------------------
STEP 4️⃣ : SAVE & REDEPLOY
---------------------------------------------------------
• Click "Save Changes"
• Render automatically redeploys
• Watch logs

EXPECTED LOGS:
--------------
Product service initializing...
Product service started successfully.

---------------------------------------------------------
STEP 5️⃣ : FIRST-TIME DB CHECK (IMPORTANT)
---------------------------------------------------------
IF DB WAS EMPTY:
• You already ran `flask db upgrade` locally with Neon URL
• No action needed on Render

IF DB WAS MANUAL:
• You already ran `flask db stamp <revision>`
• No action needed on Render

⚠️ NEVER run migrate/upgrade directly on Render shell

---------------------------------------------------------
STEP 6️⃣ : VERIFY AFTER DEPLOY
---------------------------------------------------------

OPTION A – API CHECK:
---------------------
GET https://<service>.onrender.com/health
GET https://<service>.onrender.com/api/angularProduct/get

OPTION B – NEON CHECK:
----------------------
SELECT * FROM alembic_version;

Expected:
version_num = <latest_revision>

---------------------------------------------------------
WHAT YOU MUST NEVER DO
---------------------------------------------------------
❌ Do NOT change code for DB switch
❌ Do NOT run flask db migrate on Render
❌ Do NOT reset cloud DB
❌ Do NOT share DB between services

---------------------------------------------------------
FINAL MENTAL MODEL (RENDER)
---------------------------------------------------------
New Neon DB
→ Update DATABASE_URL on Render
→ Auto Redeploy
→ App uses new DB
→ DONE

---------------------------------------------------------
FINAL CONFIRMATION
---------------------------------------------------------
YES — when you create a new Neon DB:
• Only update DATABASE_URL in Render
• Redeploy
• Verify
Nothing else changes.

=========================================================
END OF FILE
=========================================================
